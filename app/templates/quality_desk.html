{% extends "base.html" %}
{% block title %}Контроль качества{% endblock %}

{% block content %}
<header class="page-header">
    <h2 class="page-title">Контроль качества</h2>
</header>

<section class="form-card" style="margin-bottom: 16px;">
    <h3 style="margin-top: 0;">Открытые запросы помощи</h3>

    <table class="data-table" style="margin-top: 10px;">
        <thead>
        <tr>
            <th>ID</th>
            <th>Заявка</th>
            <th>Создал</th>
            <th>Дата</th>
            <th>Сообщение</th>
            <th class="column-actions">Действия</th>
        </tr>
        </thead>
        <tbody>
        {% for h in open_help %}
        <tr>
            <td class="cell-centered">{{ h.id }}</td>
            <td class="cell-centered"><a class="link-action" href="/ui/requests/{{ h.request_id }}">№{{ h.request_id }}</a></td>
            <td>{{ h.created_by_master.fio }}</td>
            <td>{{ h.created_at.strftime("%Y-%m-%d %H:%M") }}</td>
            <td>{{ h.message }}</td>
            <td class="table-actions">
                <a class="link-action" href="/ui/help/{{ h.id }}">Открыть</a>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="6" class="table-empty">Открытых запросов помощи нет.</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</section>

<section class="form-card">
    <h3 style="margin-top: 0;">Просроченные заявки</h3>

    <table class="data-table" style="margin-top: 10px;">
        <thead>
        <tr>
            <th>ID</th>
            <th>Дата</th>
            <th>Плановый срок</th>
            <th>Статус</th>
            <th>Исполнитель</th>
            <th>Заказчик</th>
            <th class="column-actions">Действия</th>
        </tr>
        </thead>
        <tbody>
        {% for r in overdue_requests %}
        <tr>
            <td class="cell-centered">{{ r.id }}</td>
            <td>{{ r.start_date }}</td>
            <td>{{ r.due_date }}</td>
            <td>{{ r.status.name }}</td>
            <td>{% if r.master %}{{ r.master.fio }}{% else %}—{% endif %}</td>
            <td>{{ r.client.fio }}</td>
            <td class="table-actions">
                <a class="link-action" href="/ui/requests/{{ r.id }}">Открыть</a>
                <a class="link-action" href="/ui/requests/{{ r.id }}/edit">Изменить</a>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="7" class="table-empty">Просроченных заявок нет.</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</section>
{% endblock %}