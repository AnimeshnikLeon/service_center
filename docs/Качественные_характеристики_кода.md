# Качественные характеристики кода

## 1. Полнота обработки ошибочных данных

- Валидация форм заявок, пользователей и запросов помощи:
  - обязательность ключевых полей (дата, описание проблемы, заказчик, сообщение запроса помощи);
  - проверка формата дат и числовых полей;
  - контроль совпадения паролей при создании пользователя;
  - запрет пустых комментариев и запросов помощи.
- На уровне БД действуют ограничения целостности:
  - `CHECK` на даты (`completion_date`, `due_date >= start_date`);
  - `FOREIGN KEY` на справочники и пользователей;
  - триггеры в `init.sql` для проверки ролей исполнителя и заказчика.
- Бизнес‑логика дополнительно валидирует:
  - недопустимые переходы статусов;
  - запрет создания запросов помощи по чужим заявкам;
  - невозможность назначить исполнителя без роли мастера.

## 2. Наличие тестов для проверки допустимых значений

- `tests/test_statistics.py` — проверка корректности расчёта общей статистики.
- `tests/test_rbac.py` — проверка ограничений по ролям и переходам статусов.
- `tests/test_help_requests.py` — контроль правил создания запросов помощи
  (только свои заявки, запрет дубликатов открытых запросов).

## 3. Средства контроля корректности входных данных

- `parse_int` и `parse_date` в `ui_utils.py` выполняют безопасный разбор
  входных значений и возвращают ошибки валидации.
- `build_status_messages` переводит коды ошибок в понятные сообщения для пользователя.
- SQLAlchemy обеспечивает параметризацию запросов и снижает риск SQL‑инъекций.
- `services.hash_password` использует PBKDF2‑HMAC и соль для хранения паролей.

## 4. Средства восстановления при сбоях оборудования

- Скрипты резервного копирования:
  - `scripts/backup_db.sh` (Linux/macOS);
  - `scripts/backup_db.ps1` (Windows).
- Для восстановления используется `pg_restore`.
- В учебной среде допускается полное восстановление БД из `init.sql`
  и повторный импорт CSV‑данных.
- Для контроля качества доступна QR‑ссылка, хранимая в переменных окружения,
  что позволяет оперативно менять форму опроса без правки кода.

## 5. Наличие комментариев

- Комментарии используются точечно для пояснения бизнес‑правил
  и нетривиальной логики (например, ограничения RBAC, расчёты статистики).
- Отсутствуют дублирующие очевидный код комментарии.

## 6. Проверка корректности передаваемых данных

- На уровне бизнес‑логики (`usecases.py`) используются проверки прав доступа:
  - `user_can_create_request`, `user_can_edit_request`, `user_can_delete_request`;
  - `user_can_create_help_request`, `user_can_handle_help_request`;
  - `user_can_change_status`.
- При нарушениях прав выбрасываются специализированные исключения
  (`PermissionDeniedError`, `StatusChangeForbiddenError` и др.).

## 7. Наличие описаний основных функций

- Документация описывает:
  - структуру проекта и процедуры запуска;
  - схему БД и роли пользователей;
  - функционал запросов помощи и QR‑кода для оценки качества.
- Ключевые функции сгруппированы в слоях `services.py`, `usecases.py` и `rbac.py`.

## 8. Контроль корректности и устойчивость к ошибкам

- Обработка ошибок БД происходит через транзакции с `commit/rollback`.
- Ошибки бизнес‑правил возвращаются как читаемые пользователем сообщения
  с подсказками по исправлению.

## 9. Вывод
Кодовая база содержит контролируемую валидацию ввода, RBAC‑проверки,
тестовое покрытие ключевых сценариев, средства резервного копирования
и сопровождается эксплуатационной документацией, что соответствует требованиям
по качественным характеристикам учебного проекта.
